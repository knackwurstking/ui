// Package components contains reusable UI components
package ui

import "net/http"

// DialogOptions defines the properties for a dialog component
type DialogOptions struct {
	// ID is the unique identifier for the dialog
	ID string

	// Method specifies the HTTP method to use when submitting the form
	Method string

	// Href is the URL to submit the form data to
	Href templ.SafeURL

	// SubmitButtonText is the text displayed on the submit button
	SubmitButtonText string

	// Error is an error that may have occurred, displayed if not nil
	Error error

	// HxSwapOOB is an additional property used for hx-swap-oob directive
	HxSwapOOB string

	// AdditionalActions represents additional actions that can be rendered
	AdditionalActions templ.Component

	FormClasses templ.CSSClasses
}

// Dialog is a reusable dialog component that renders a dialog with form input
// and optional additional actions.
templ Dialog(o DialogOptions) {
	// onclose is a script that will remove the dialog when it is closed
	{{
		onclose := templ.ComponentScript{
			Call: `this.remove();`,
		}
	}}
	// Render a dialog element with various attributes and form elements
	<dialog
		id={ o.ID }
		class="fullscreen clean flex flex-col justify-center items-center"
		onclose={ onclose }
		oncancel="event.preventDefault()"
		onclick="if (event.target === this) event.preventDefault()"
		if o.HxSwapOOB != "" {
			hx-swap-oob={ o.HxSwapOOB }
		}
	>
		<form
			class={ "flex flex-col gap p w-full " + o.FormClasses.String() }
			if o.Method == http.MethodPost {
				hx-post={ o.Href }
			}
			if o.Method == http.MethodPut {
				hx-put={ o.Href }
			}
			hx-target="body"
			hx-swap="beforeend"
			hx-on::response-error="alert(event.detail.xhr.responseText)"
			hx-on::after-request="if (event.detail.successful) this.closest('dialog').close();"
			enctype="multipart/form-data"
			onclick="event.stopPropagation()"
		>
			<div
				name="dialog-content"
				class="flex flex-col gap overflow-y-scroll scroll-smooth no-scrollbar p h-full"
			>
				if o.Error != nil {
					<div class="card compact destructive debug">
						<div class="card-body">
							{ o.Error.Error() }
						</div>
					</div>
				}
				{ children... }
			</div>
			<footer class="flex gap justify-end">
				if o.AdditionalActions != nil {
					@o.AdditionalActions
				}
				<button
					name="close"
					class="secondary flex gap"
					type="button"
					onclick="this.closest('dialog').close()"
				>
					<i class="bi bi-x-circle"></i>
					Abbrechen
				</button>
				<button
					type="submit"
					class="flex gap"
				>
					<i class="bi bi-check-circle"></i>
					if o.SubmitButtonText == "" {
						Submit
					} else {
						{ o.SubmitButtonText }
					}
				</button>
			</footer>
		</form>
		<script defer>
			document.querySelector('#{{ o.ID }}').showModal();
		</script>
	</dialog>
}
